'use strict';

const fs = require('fs');
const path = require('path');
const os = require('os');
const package = require('../package.json');
const releaseId = package.kernelVersion;

console.log(`### version "${package.version}" (release #${releaseId.toString(16)})`);

// Write kernel version
const configKernel = path.join(__dirname, '../src/kernel/version-autogenerated.h');
try {
  fs.writeFileSync(configKernel, String(releaseId) + os.EOL);
} catch (e) {
  // Ignore this when running on installed package that contains js code only
}

// Write runtimecorelib.json
const configCorelib = path.join(__dirname, '../runtimecorelib.json');
const corelib = {
  kernelVersion: releaseId,
};
fs.writeFileSync(configCorelib, JSON.stringify(corelib, null, 2) + os.EOL);
